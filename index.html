<!DOCTYPE HTML>
<html>

<head>
    <title>Geometric-Aware 4D Video Generation</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="icon" href="assets/video-player.png">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LS6L6LB7RX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-LS6L6LB7RX');
    </script>

    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Geometry-aware 4D Video Generation for Robot Manipulation" />
    <meta property="og:description" content="" />
</head>

<body>
    <div class="main-container">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <!-- <div class="university-logos">
                    <div class="logo-container">
                        <img src="images/stanford_logo.png" alt="Stanford University">
                    </div>
                    <div class="logo-container">
                        <img src="images/tri_logo_landscape.svg" alt="Toyota Research Institute">
                    </div>
                </div> -->

                <h1 class="main-title">
                    Geometry-aware 4D Video Generation <br> for Robot Manipulation
                </h1>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-section">
            <div class="teaser-video">
                <video autoplay loop muted playsinline>
                    <source src="videos/teaser.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <!-- TLDR Section -->
            <div class="tldr-section">
                <div class="tldr-content">
                    We propose a 4D video generation model that enforces geometric consistency across multiple views to
                    generate spatio-temporally aligned RGB-D videos from a single RGB-D image per view. We further
                    demonstrate applications on robot manipulation by extracting gripper poses from the generated videos 
                    with an off-the-shelf pose tracking algorithm.
                </div>
            </div>

            <hr class="section-divider">

            <!-- Method Section -->
            <h2 class="section-title">Method</h2>
            <div class="method-image">
                <img src="assets/method.png" alt="Method Overview">
                <p class="method-caption">
                    Our model takes RGB-D inputs from two camera viewpoints and predicts future pointmaps alongside RGB
                    images. To enforce geometric consistency across views, we introduce cross-attention layers
                    in the U-Net decoders for pointmap prediction. 
                    The resulting 4D video can then be used with off-the-shelf RGB-D pose tracking methods to recover the 6-DoF
                    pose of the robot end-effector, enabling direct application to downstream manipulation tasks.
                </p>
            </div>

            <hr class="section-divider">

            <!-- Results Section -->
            <!-- <div class="results-header">
                <h2 class="section-title" style="margin-bottom: 0;">Results</h2>
                <a href="pages/videos.html" class="more-videos-link">
                    Click here to see more generated videos
                </a>
            </div> -->

            <!-- Task 1: StoreCerealBoxUnderShelf -->
            <div class="task-section">
                <h3 class="task-title">
                    (a) StoreCerealBoxUnderShelf ü•£
                </h3>
                <p class="task-description">
                    In this task, a single robot arm picks up a cereal box from the top of a shelf and
                    inserts it into the shelf below. Occlusions occur during insertion, especially from certain camera
                    viewpoints,
                    making multi-view predictions essential. Additionally, the pick-and-insert action requires spatial
                    understanding
                    and precision.
                </p>

                <div class="video-section-header">Ground-truth RGB-D videos</div>
                <div class="video-compare-container" id="container1">
                    <video class="video-canvas rgb-video" id="rgbVideo1" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(1)">
                        <source src="videos/task_1/gt_rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo1" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(1)">
                        <source src="videos/task_1/gt_depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider1"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn1" onclick="switchVideo1(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo1">Result 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn1" onclick="switchVideo1(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(1)" id="playButton1">Play</button>
                </div>

                <div class="video-section-header">Generated RGB-D videos (unseen views)</div>
                <div class="video-compare-container" id="container2">
                    <video class="video-canvas rgb-video" id="rgbVideo2" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(2)">
                        <source src="videos/task_1/ours/rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo2" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(2)">
                        <source src="videos/task_1/ours/depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider2"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn2" onclick="switchVideo2(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo2">Result 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn2" onclick="switchVideo2(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(2)" id="playButton2">Play</button>
                </div>

                <!-- Baselines -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Baselines:</h4>
                <div class="baseline-grid">
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (RGB)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (depth)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/baselines/svd.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD w/ cross-attention</div>
                    </div>
                </div>

                <!-- Policy Rollout -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Policy Rollout (unseen views):
                </h4>
                <div class="policy-grid">
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/ours_2.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/ours_3.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/dp3.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">3D Diffusion Policy <span class="failure-text">fails to insert the
                                cereal box</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/dp3_2.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">3D Diffusion Policy <span class="failure-text">fails to pick up the
                                cereal box</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/dp_2.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">Multi-View Diffusion Policy <span class="failure-text">fails to insert the
                                cereal box</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_1/dp.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">Multi-View Diffusion Policy <span class="failure-text">fails to pick up the
                                cereal box</span></div>
                    </div>
                </div>
            </div>

            <!-- Task 2: PutSpatulaOnTable -->
            <div class="task-section">
                <h3 class="task-title">
                    (b) PutSpatulaOnTable üë©‚Äçüç≥
                </h3>
                <p class="task-description">
                    A single robot arm retrieves a spatula from a utensil crock and places it on the left side of the
                    table. This
                    task requires precise manipulation to successfully grasp the narrow object.
                </p>

                <div class="video-section-header">Ground-truth RGB-D videos</div>
                <div class="video-compare-container" id="container3">
                    <video class="video-canvas rgb-video" id="rgbVideo3" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(3)">
                        <source src="videos/task_2/gt_rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo3" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(3)">
                        <source src="videos/task_2/gt_depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider3"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn3" onclick="switchVideo3(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo3">Result 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn3" onclick="switchVideo3(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(3)" id="playButton3">Play</button>
                </div>

                <div class="video-section-header">Generated RGB-D videos (unseen views)</div>
                <div class="video-compare-container" id="container4">
                    <video class="video-canvas rgb-video" id="rgbVideo4" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(4)">
                        <source src="videos/task_2/ours/rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo4" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(4)">
                        <source src="videos/task_2/ours/depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider4"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn4" onclick="switchVideo4(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo4">Result 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn4" onclick="switchVideo4(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(4)" id="playButton4">Play</button>
                </div>

                <!-- Baselines -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Baselines:</h4>
                <div class="baseline-grid">
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (RGB)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (depth)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/baselines/svd.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD with cross-attention</div>
                    </div>
                </div>

                <!-- Policy Rollout -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Policy Rollout (unseen views):
                </h4>
                <div class="policy-grid">
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/ours.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/ours_2.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/dp3.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">3D Diffusion Policy <span class="failure-text">fails to grasp the
                                spatula</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_2/dp.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">Diffusion Policy <span class="failure-text">fails to grasp the
                                spatula</span></div>
                    </div>
                </div>
            </div>

            <!-- Task 3: PlaceAppleFromBowlIntoBin -->
            <div class="task-section">
                <h3 class="task-title">
                    (c) PlaceAppleFromBowlIntoBin üçé
                </h3>
                <p class="task-description">
                    One robot arm picks up an apple from a bowl on the left side of the table and places it on a shelf;
                    a second arm
                    then picks up the apple and deposits it into a bin on the right side. This is a long-horizon,
                    bimanual task that
                    tests the model's ability to predict both temporally and spatially consistent trajectories.
                </p>

                <div class="video-section-header">Ground-truth RGB-D videos</div>
                <div class="video-compare-container" id="container5">
                    <video class="video-canvas rgb-video" id="rgbVideo5" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(5)">
                        <source src="videos/task_3/gt_rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo5" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(5)">
                        <source src="videos/task_3/gt_depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider5"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn5" onclick="switchVideo5(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo5">GT 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn5" onclick="switchVideo5(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(5)" id="playButton5">Play</button>
                </div>

                <div class="video-section-header">Generated RGB-D videos (unseen views)</div>
                <div class="video-compare-container" id="container6">
                    <video class="video-canvas rgb-video" id="rgbVideo6" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(6)">
                        <source src="videos/task_3/ours/rgb_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo6" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(6)">
                        <source src="videos/task_3/ours/depth_1.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider6"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn6" onclick="switchVideo6(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo6">Result 1 of 2</div>
                    <button class="nav-arrow" id="nextBtn6" onclick="switchVideo6(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(6)" id="playButton6">Play</button>
                </div>

                <!-- Baselines -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Baselines:</h4>
                <div class="baseline-grid">
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (RGB)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                        <div class="caption">OURS without cross-attention (depth)</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/baselines/svd.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD</div>
                    </div>
                    <div class="baseline-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                        <div class="caption">SVD with cross-attention</div>
                    </div>
                </div>

                <!-- Policy Rollout -->
                <h4 style="margin: 40px 0 20px 0; font-size: 1.5rem; color: #2c3e50;">Policy Rollout (unseen views):
                </h4>
                <div class="policy-grid">
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/ours.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/ours_2.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">OURS <span class="success-badge">Success</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/dp3.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">3D Diffusion Policy <span class="failure-text">fails to pick up the
                                apple</span></div>
                    </div>
                    <div class="policy-item">
                        <video controls autoplay loop muted playsinline>
                            <source src="videos/task_3/dp.mp4" type="video/mp4">
                        </video>
                        <div class="policy-caption">Diffusion Policy <span class="failure-text">fails to pick up the
                                apple</span></div>
                    </div>
                </div>
            </div>
            
            <!-- Task 4: Real World Results -->
            <div class="task-section">
                <h3 class="task-title">
                    (d) Real World Results üåç
                </h3>
                <p class="task-description">
                    By finetuning a policy trained in simulation, our model transfers to real world RGB-D videos for several manipulation tasks.
                </p>

                <div class="video-section-header">Generated RGB-D videos</div>
                <div class="video-compare-container" id="container7">
                    <video class="video-canvas rgb-video" id="rgbVideo7" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(7)">
                        <source src="videos/real/rgb_orange.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <video class="video-canvas depth-video" id="depthVideo7" loop muted preload="metadata" autoplay
                        onloadeddata="setupVideo(7)">
                        <source src="videos/real/depth_orange.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="divider" id="divider7"></div>
                    <div class="labels">
                        <div class="label label-left">RGB</div>
                        <div class="label label-right">DEPTH</div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-arrow" id="prevBtn7" onclick="switchVideo7(-1)">‚Üê</button>
                    <div class="video-info" id="videoInfo7">Spatula (1 of 4)</div>
                    <button class="nav-arrow" id="nextBtn7" onclick="switchVideo7(1)">‚Üí</button>
                </div>

                <div class="controls">
                    <button onclick="togglePlayback(7)" id="playButton7">Play</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for video functionality -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.poptrox.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        // Store multiple video comparison instances
        const videoComparisons = {};

        // Video sets for all tasks
        const videoSets = {
            task1_gt: [
                { rgb: "videos/task_1/gt_rgb_1.mp4", depth: "videos/task_1/gt_depth_1.mp4", title: "GT" },
                { rgb: "videos/task_1/gt_rgb_2.mp4", depth: "videos/task_1/gt_depth_2.mp4", title: "GT" }
            ],
            task1_ours: [
                { rgb: "videos/task_1/ours/rgb_1.mp4", depth: "videos/task_1/ours/depth_1.mp4", title: "Result" },
                { rgb: "videos/task_1/ours/rgb_2.mp4", depth: "videos/task_1/ours/depth_2.mp4", title: "Result" }
            ],
            task2_gt: [
                { rgb: "videos/task_2/gt_rgb_1.mp4", depth: "videos/task_2/gt_depth_1.mp4", title: "GT" },
                { rgb: "videos/task_2/gt_rgb_2.mp4", depth: "videos/task_2/gt_depth_2.mp4", title: "GT" }
            ],
            task2_ours: [
                { rgb: "videos/task_2/ours/rgb_1.mp4", depth: "videos/task_2/ours/depth_1.mp4", title: "Result" },
                { rgb: "videos/task_2/ours/rgb_2.mp4", depth: "videos/task_2/ours/depth_2.mp4", title: "Result" }
            ],
            task3_gt: [
                { rgb: "videos/task_3/gt_rgb_1.mp4", depth: "videos/task_3/gt_depth_1.mp4", title: "GT" },
                { rgb: "videos/task_3/gt_rgb_2.mp4", depth: "videos/task_3/gt_depth_2.mp4", title: "GT" }
            ],
            task3_ours: [
                { rgb: "videos/task_3/ours/rgb_1.mp4", depth: "videos/task_3/ours/depth_1.mp4", title: "Result" },
                { rgb: "videos/task_3/ours/rgb_2.mp4", depth: "videos/task_3/ours/depth_2.mp4", title: "Result" }
            ],
            real_world: [
                { rgb: "videos/real/rgb_orange.mp4", depth: "videos/real/depth_orange.mp4", title: "Orange" },
                { rgb: "videos/real/rgb_spatula.mp4", depth: "videos/real/depth_spatula.mp4", title: "Spatula" },
                { rgb: "videos/real/rgb_bottle.mp4", depth: "videos/real/depth_bottle.mp4", title: "Bottle" },
                { rgb: "videos/real/rgb_cup.mp4", depth: "videos/real/depth_cup.mp4", title: "Cup" },
            ]
        };

        // Track current video index for each container
        const currentVideoIndexes = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0 };

        // Map container IDs to video sets
        const containerToVideoSet = {
            1: 'task1_gt', 2: 'task1_ours', 3: 'task2_gt',
            4: 'task2_ours', 5: 'task3_gt', 6: 'task3_ours', 7: 'real_world'
        };

        function setupVideo(instanceId) {
            if (!videoComparisons[instanceId]) {
                videoComparisons[instanceId] = {
                    videosLoaded: 0, isDragging: false, autoFollow: true,
                    container: null, divider: null, rgbVideo: null, depthVideo: null
                };
            }

            videoComparisons[instanceId].videosLoaded++;
            if (videoComparisons[instanceId].videosLoaded === 2) {
                initializeDemo(instanceId);
            }
        }

        function initializeDemo(instanceId) {
            const instance = videoComparisons[instanceId];
            instance.container = document.getElementById(`container${instanceId}`);
            instance.divider = document.getElementById(`divider${instanceId}`);
            instance.rgbVideo = document.getElementById(`rgbVideo${instanceId}`);
            instance.depthVideo = document.getElementById(`depthVideo${instanceId}`);

            if (!instance.container || !instance.divider || !instance.rgbVideo || !instance.depthVideo) {
                console.error(`Missing elements for instance ${instanceId}`);
                return;
            }

            // Sync video playback
            instance.rgbVideo.addEventListener('play', () => {
                instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
                instance.depthVideo.play().catch(e => console.error(`Depth video ${instanceId} play failed:`, e));
                updatePlayButton(instanceId);
            });

            instance.rgbVideo.addEventListener('pause', () => {
                instance.depthVideo.pause();
                updatePlayButton(instanceId);
            });

            instance.rgbVideo.addEventListener('seeked', () => {
                instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
            });

            instance.rgbVideo.addEventListener('timeupdate', () => {
                if (Math.abs(instance.rgbVideo.currentTime - instance.depthVideo.currentTime) > 0.1) {
                    instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
                }
            });

            instance.rgbVideo.addEventListener('ended', () => {
                instance.depthVideo.pause();
                updatePlayButton(instanceId);
            });

            setupDragHandlers(instanceId);
            updatePlayButton(instanceId);

            if (containerToVideoSet[instanceId]) {
                updateNavigation(instanceId);
            }
        }

        function setupDragHandlers(instanceId) {
            const instance = videoComparisons[instanceId];
            instance.divider.addEventListener('mousedown', (e) => startDrag(e, instanceId));
            instance.container.addEventListener('mousemove', (e) => handleMouseMoveForInstance(e, instanceId));
            instance.divider.addEventListener('touchstart', (e) => startDrag(e, instanceId));
        }

        function startDrag(e, instanceId) {
            const instance = videoComparisons[instanceId];
            instance.isDragging = true;
            instance.autoFollow = false;
            e.preventDefault();
            instance.container.style.cursor = 'col-resize';

            const handleMouseMove = (e) => handleMouseMoveForInstance(e, instanceId);
            const handleTouchMove = (e) => handleTouchMoveForInstance(e, instanceId);
            const endDrag = () => endDragForInstance(instanceId, handleMouseMove, handleTouchMove, endDrag);

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', endDrag);
        }

        function handleMouseMoveForInstance(e, instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance.isDragging && !instance.autoFollow) return;

            const rect = instance.container.getBoundingClientRect();
            const isOverContainer = e.clientX >= rect.left && e.clientX <= rect.right &&
                e.clientY >= rect.top && e.clientY <= rect.bottom;

            if (isOverContainer || instance.isDragging) {
                const x = e.clientX - rect.left;
                const percentage = (x / rect.width) * 100;
                const clampedPercentage = Math.max(0, Math.min(100, percentage));
                updateDividerPosition(instanceId, clampedPercentage);
            }
        }

        function handleTouchMoveForInstance(e, instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance.isDragging) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = instance.container.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const percentage = (x / rect.width) * 100;
            const clampedPercentage = Math.max(0, Math.min(100, percentage));
            updateDividerPosition(instanceId, clampedPercentage);
        }

        function endDragForInstance(instanceId, handleMouseMove, handleTouchMove, endDrag) {
            const instance = videoComparisons[instanceId];
            if (instance.isDragging) {
                instance.isDragging = false;
                instance.container.style.cursor = 'col-resize';

                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchmove', handleTouchMove);
                document.removeEventListener('touchend', endDrag);

                setTimeout(() => { instance.autoFollow = true; }, 2000);
            }
        }

        function updateDividerPosition(instanceId, percentage) {
            const instance = videoComparisons[instanceId];
            if (!instance.divider || !instance.rgbVideo || !instance.depthVideo) return;

            instance.divider.style.left = percentage + '%';
            const leftClip = `inset(0 ${100 - percentage}% 0 0)`;
            const rightClip = `inset(0 0 0 ${percentage}%)`;
            instance.rgbVideo.style.clipPath = leftClip;
            instance.depthVideo.style.clipPath = rightClip;
        }

        function togglePlayback(instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance || !instance.rgbVideo || !instance.depthVideo) return;

            if (instance.rgbVideo.paused) {
                instance.rgbVideo.play().catch(e => console.error(`Play failed for instance ${instanceId}:`, e));
            } else {
                instance.rgbVideo.pause();
            }
        }

        function updatePlayButton(instanceId) {
            const button = document.getElementById(`playButton${instanceId}`);
            const instance = videoComparisons[instanceId];

            if (!button || !instance || !instance.rgbVideo) {
                if (button) button.textContent = 'Play';
                return;
            }

            button.textContent = instance.rgbVideo.paused ? 'Play' : 'Pause';
        }

        function switchVideo(containerId, direction) {
            const videoSetKey = containerToVideoSet[containerId];
            if (!videoSetKey || !videoSets[videoSetKey]) return;

            const currentIndex = currentVideoIndexes[containerId];
            const newIndex = currentIndex + direction;

            if (newIndex < 0 || newIndex >= videoSets[videoSetKey].length) return;

            currentVideoIndexes[containerId] = newIndex;

            const rgbVideo = document.getElementById(`rgbVideo${containerId}`);
            const depthVideo = document.getElementById(`depthVideo${containerId}`);

            if (!rgbVideo || !depthVideo) {
                console.error(`Video elements not found for container ${containerId}`);
                return;
            }

            rgbVideo.pause();
            depthVideo.pause();

            rgbVideo.src = videoSets[videoSetKey][newIndex].rgb;
            depthVideo.src = videoSets[videoSetKey][newIndex].depth;

            rgbVideo.load();
            depthVideo.load();

            updateNavigation(containerId);
            updateDividerPosition(containerId, 50);
            updatePlayButton(containerId);
        }

        function updateNavigation(containerId) {
            const videoSetKey = containerToVideoSet[containerId];
            if (!videoSetKey || !videoSets[videoSetKey]) return;

            const currentIndex = currentVideoIndexes[containerId];
            const videoInfo = document.getElementById(`videoInfo${containerId}`);
            const prevBtn = document.getElementById(`prevBtn${containerId}`);
            const nextBtn = document.getElementById(`nextBtn${containerId}`);

            if (videoInfo) {
                videoInfo.textContent = `${videoSets[videoSetKey][currentIndex].title} (${currentIndex + 1} of ${videoSets[videoSetKey].length})`;
            }

            if (prevBtn) prevBtn.disabled = currentIndex === 0;
            if (nextBtn) nextBtn.disabled = currentIndex === videoSets[videoSetKey].length - 1;
        }

        // Individual switching functions
        function switchVideo1(direction) { switchVideo(1, direction); }
        function switchVideo2(direction) { switchVideo(2, direction); }
        function switchVideo3(direction) { switchVideo(3, direction); }
        function switchVideo4(direction) { switchVideo(4, direction); }
        function switchVideo5(direction) { switchVideo(5, direction); }
        function switchVideo6(direction) { switchVideo(6, direction); }
        function switchVideo7(direction) { switchVideo(7, direction); }

        // Initialize when page loads
        window.addEventListener('load', () => {
            for (let i = 1; i <= 7; i++) {
                if (document.getElementById(`rgbVideo${i}`)) {
                    if (!videoComparisons[i]) {
                        videoComparisons[i] = {
                            videosLoaded: 0, isDragging: false, autoFollow: true,
                            container: null, divider: null, rgbVideo: null, depthVideo: null
                        };
                    }
                    updatePlayButton(i);
                }
            }
        });
    </script>
</body>

</html>