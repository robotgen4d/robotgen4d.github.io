<!DOCTYPE HTML>
<html>

<head>
    <title>Geometric-Aware 4D Video Generation</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1000">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="icon" href="assets/video-player.png">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LS6L6LB7RX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-LS6L6LB7RX');
    </script>

    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Geometry-aware 4D Video Generation for Robot Manipulation" />
    <meta property="og:description" content="" />

    <style>
        .video-compare-container {
            position: relative;
            max-width: 75%;
            margin: 0 auto;
            overflow: hidden;
            border: 2px solid #333;
            cursor: col-resize;
            aspect-ratio: 32/10;
            transition: border-color 0.2s ease;
            margin-bottom: 1em;
        }
        
        .video-compare-container:hover {
            border-color: #555;
        }
        
        .video-canvas {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .rgb-video {
            left: 0;
            clip-path: inset(0 50% 0 0);
        }
        
        .depth-video {
            right: 0;
            clip-path: inset(0 0 0 50%);
        }
        
        .divider {
            position: absolute;
            top: 0;
            left: 50%;
            width: 4px;
            height: 100%;
            background: #fff;
            cursor: col-resize;
            z-index: 10;
            transform: translateX(-2px);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .divider::after {
            content: '‚ü∑';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            color: #000;
            font-weight: bold;
        }
        
        .labels {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            z-index: 5;
            pointer-events: none;
        }
        
        .label {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px;
        }
        
        .label-left {
            left: 10px;
        }
        
        .label-right {
            right: 10px;
        }
        
        .controls {
            margin-top: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .controls button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .controls button:hover {
            background: #555;
        }
        
        .controls button:disabled {
            background: #222;
            color: #666;
            cursor: not-allowed;
        }
    </style>
</head>

<body id="top">

    <!-- Main -->
    <div id="main"
        style="padding-bottom:1em; padding-top: 5em; width: 70em; max-width: 70em; margin-left: auto; margin-right: auto;">
        
        <h2 style="text-align: center; white-space: nowrap; font-size: 200%">
            Geometry-aware 4D Video Generation for Robot Manipulation
        </h2>

        <p style="color: black;">Understanding and predicting the dynamics of the physical world can enhance a robot's
            ability to plan and interact effectively in complex environments. While recent video generation models have
            shown strong potential in modeling dynamic scenes, generating videos that are both temporally coherent and
            geometrically consistent across camera views remains a significant challenge. To address this, we propose a
            4D video generation model that enforces multi-view 3D consistency of videos by supervising the model with
            cross-view pointmap alignment during training. This geometric supervision enables the model to learn a
            shared 3D representation of the scene, allowing it to predict future video sequences from novel viewpoints
            based solely on the given RGB-D observations, without requiring camera poses as inputs.
            Compared to existing baselines, our method produces more visually stable and spatially aligned predictions
            across multiple simulated and real-world robotic datasets. We further show that the predicted 4D videos can
            be used to recover robot end-effector trajectories using an off-the-shelf 6DoF pose tracker, supporting
            robust robot manipulation and generalization to novel camera viewpoints.
        </p>

        <hr>
        <h3>Method</h3>
        <div style="text-align: center; margin: 2em 0;">
            <img src="assets/method.png" alt="Method Overview"
                style="width: 100%; max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;">
            <p style="font-style: italic; color: #666; margin-top: 0.5em; font-size: 0.9em;">
                4D Video Generation for Robot Manipulation. Our model takes RGB-D observations from two camera views,
                and predicts future pointmaps and RGB videos.
                To ensure cross-view consistency, we apply cross-attention in the U-Net decoders for pointmap
                prediction. The resulting 4D video can be used to extract the 6DoF pose of the robot end-effector using
                pose tracking methods, enabling downstream manipulation tasks.
            </p>
        </div>

        <hr>
        <h3>Results</h3>
        <h4> (a) StoreCerealBoxUnderShelf ü•£</h4>
        In this task, a single robot arm picks up a cereal box from the top of a shelf and
        inserts it into the shelf below. Occlusions occur during insertion, especially from certain camera viewpoints,
        making multi-view predictions essential. Additionally, the pick-and-insert action requires spatial understanding
        and precision.

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <div style="text-align: center; margin-bottom: 15px;">
                <strong>Ground-truth RGB-D videos</strong>
            </div>
            <div class="video-compare-container" id="container1">
                <video class="video-canvas rgb-video" id="rgbVideo1" loop muted preload="metadata" autoplay onloadeddata="setupVideo(1)">
                    <source src="videos/task_1/gt_rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo1" loop muted preload="metadata" autoplay onloadeddata="setupVideo(1)">
                    <source src="videos/task_1/gt_depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider1"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(1)" id="playButton1">Play</button>
            </div>

            <div style="text-align: center; margin: 15px 0;">
                <strong>Generated RGB-D videos (unseen views)</strong>
            </div>
            <div class="video-compare-container" id="container2">
                <video class="video-canvas rgb-video" id="rgbVideo2" loop muted preload="metadata" autoplay onloadeddata="setupVideo(2)">
                    <source src="videos/task_1/ours/rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo2" loop muted preload="metadata" autoplay onloadeddata="setupVideo(2)">
                    <source src="videos/task_1/ours/depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider2"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(2)" id="playButton2">Play</button>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Baselines:</h4>
            <div class="row 50% uniform" style="width: 100%;">
                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (RGB)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (depth)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/baselines/svd.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD w/ cross-attention
                </div>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Policy Rollout (unseen views):</h4>
            <div class="row 50% uniform" style="width: 100%;">
                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/ours.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/ours_2.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS
                </div>
            </div>
            <div class="row 50% uniform" style="width: 100%;">
                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/dp_2.mp4" type="video/mp4">
                        </video>
                    </span>
                    Diffusion Policy <span style="color: red";>fails to insert the cereal box</span>
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_1/dp.mp4" type="video/mp4">
                        </video>
                    </span>
                    Diffusion Policy <span style="color: red";>fails to pick up the cereal box</span>
                </div>
            </div>
        </div>

        <br>

        <h4> (b) PutSpatulaOnTable üë©‚Äçüç≥</h4>
        A single robot arm retrieves a spatula from a utensil crock and places it on the left side of the table. This
        task requires precise manipulation to successfully grasp the narrow object.

 
        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <div style="text-align: center; margin-bottom: 15px;">
                <strong>Ground-truth RGB-D videos</strong>
            </div>
            <div class="video-compare-container" id="container3">
                <video class="video-canvas rgb-video" id="rgbVideo3" loop muted preload="metadata" autoplay onloadeddata="setupVideo(3)">
                    <source src="videos/task_2/gt_rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo3" loop muted preload="metadata" autoplay onloadeddata="setupVideo(3)">
                    <source src="videos/task_2/gt_depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider3"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(3)" id="playButton3">Play</button>
            </div>

            <div style="text-align: center; margin: 15px 0;">
                <strong>Generated RGB-D videos (unseen views)</strong>
            </div>
            <div class="video-compare-container" id="container4">
                <video class="video-canvas rgb-video" id="rgbVideo4" loop muted preload="metadata" autoplay onloadeddata="setupVideo(4)">
                    <source src="videos/task_2/ours/rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo4" loop muted preload="metadata" autoplay onloadeddata="setupVideo(4)">
                    <source src="videos/task_2/ours/depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider4"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(4)" id="playButton4">Play</button>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Baselines:</h4>
            <div class="row 50% uniform" style="width: 100%;">
                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_2/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (RGB)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_2/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (depth)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_2/baselines/svd.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_2/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD with cross-attention
                </div>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Policy Rollout (unseen views):</h4>
            <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
                <div class="row 50% uniform" style="width: 100%;">
                    <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                        <span class="image fit" style="margin-bottom: 0.5em;">
                            <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                                <source src="videos/task_2/ours.mp4" type="video/mp4">
                            </video>
                        </span>
                        OURS
                    </div>
    
                    <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                        <span class="image fit" style="margin-bottom: 0.5em;">
                            <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                                <source src="videos/task_2/dp.mp4" type="video/mp4">
                            </video>
                        </span>
                        Diffusion Policy <span style="color: red";>fails to grasp the spatula</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Real World Results:</h4>
            <div style="text-align: center; margin-bottom: 15px;">
                <strong>Generated RGB-D videos</strong>
            </div>
            <div class="video-compare-container" id="container7">
                <video class="video-canvas rgb-video" id="rgbVideo7" loop muted preload="metadata" autoplay onloadeddata="setupVideo(7)">
                    <source src="videos/task_2/real/rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo7" loop muted preload="metadata" autoplay onloadeddata="setupVideo(7)">
                    <source src="videos/task_2/real/depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider7"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(7)" id="playButton7">Play</button>
            </div>
        </div>

        <br>
        <h4> (c) PlaceAppleFromBowlIntoBin üçé</h4>
        One robot arm picks up an apple from a bowl on the left side of the table and places it on a shelf; a second arm
        then picks up the apple and deposits it into a bin on the right side. This is a long-horizon, bimanual task that
        tests the model's ability to predict both temporally and spatially consistent trajectories.

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <div style="text-align: center; margin-bottom: 15px;">
                <strong>Ground-truth RGB-D videos</strong>
            </div>
            <div class="video-compare-container" id="container5">
                <video class="video-canvas rgb-video" id="rgbVideo5" loop muted preload="metadata" autoplay onloadeddata="setupVideo(5)">
                    <source src="videos/task_3/gt_rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo5" loop muted preload="metadata" autoplay onloadeddata="setupVideo(5)">
                    <source src="videos/task_3/gt_depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider5"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(5)" id="playButton5">Play</button>
            </div>

            <div style="text-align: center; margin: 15px 0;">
                <strong>Generated RGB-D videos (unseen views)</strong>
            </div>
            <div class="video-compare-container" id="container6">
                <video class="video-canvas rgb-video" id="rgbVideo6" loop muted preload="metadata" autoplay onloadeddata="setupVideo(6)">
                    <source src="videos/task_3/ours/rgb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <video class="video-canvas depth-video" id="depthVideo6" loop muted preload="metadata" autoplay onloadeddata="setupVideo(6)">
                    <source src="videos/task_3/ours/depth.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <div class="divider" id="divider6"></div>
                
                <div class="labels">
                    <div class="label label-left">RGB</div>
                    <div class="label label-right">DEPTH</div>
                </div>
            </div>
            
            <div class="controls">
                <button onclick="togglePlayback(6)" id="playButton6">Play</button>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Baselines:</h4>
            <div class="row 50% uniform" style="width: 100%;">
                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_3/baselines/without_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (RGB)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_3/baselines/without_attn_depth.mp4" type="video/mp4">
                        </video>
                    </span>
                    OURS without cross-attention (depth)
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_3/baselines/svd.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD
                </div>

                <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                    <span class="image fit" style="margin-bottom: 0.5em;">
                        <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                            <source src="videos/task_3/baselines/svd_attn.mp4" type="video/mp4">
                        </video>
                    </span>
                    SVD with cross-attention
                </div>
            </div>
        </div>

        <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
            <h4>Policy Rollout (unseen views):</h4>
            <div class="box alt" style="margin-top:1em; margin-bottom: 1em;">
                <div class="row 50% uniform" style="width: 100%;">
                    <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                        <span class="image fit" style="margin-bottom: 0.5em;">
                            <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                                <source src="videos/task_3/ours.mp4" type="video/mp4">
                            </video>
                        </span>
                        OURS
                    </div>
    
                    <div class="2u" style="font-size: 1em; line-height: 1.5em; text-align: center; width: 50%">
                        <span class="image fit" style="margin-bottom: 0.5em;">
                            <video controls autoplay loop muted playsinline style="width: 100%; margin-right: 5%;">
                                <source src="videos/task_3/dp.mp4" type="video/mp4">
                            </video>
                        </span>
                        Diffusion Policy <span style="color: red";>fails to pick up the apple</span>
                    </div>
                </div>
            </div>
        </div>

        <hr>
    </div>

    <div style="text-align: center; justify-content: center; margin-top:15px; margin-bottom: 20px;">
        <a href="https://www.flaticon.com/free-icons/clapperboard" title="clapperboard icons">Clapperboard icons created
            by Prosymbols - Flaticon</a>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.poptrox.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        // Store multiple video comparison instances
        const videoComparisons = {};
        
        function setupVideo(instanceId) {
            if (!videoComparisons[instanceId]) {
                videoComparisons[instanceId] = {
                    videosLoaded: 0,
                    isDragging: false,
                    autoFollow: true,
                    container: null,
                    divider: null,
                    rgbVideo: null,
                    depthVideo: null
                };
            }
            
            videoComparisons[instanceId].videosLoaded++;
            
            if (videoComparisons[instanceId].videosLoaded === 2) {
                initializeDemo(instanceId);
            }
        }

        function initializeDemo(instanceId) {
            const instance = videoComparisons[instanceId];
            
            instance.container = document.getElementById(`container${instanceId}`);
            instance.divider = document.getElementById(`divider${instanceId}`);
            instance.rgbVideo = document.getElementById(`rgbVideo${instanceId}`);
            instance.depthVideo = document.getElementById(`depthVideo${instanceId}`);

            if (!instance.container || !instance.divider || !instance.rgbVideo || !instance.depthVideo) {
                console.error(`Missing elements for instance ${instanceId}`);
                return;
            }

            // Sync video playback
            instance.rgbVideo.addEventListener('play', () => {
                instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
                instance.depthVideo.play().catch(e => console.error(`Depth video ${instanceId} play failed:`, e));
                updatePlayButton(instanceId);
            });

            instance.rgbVideo.addEventListener('pause', () => {
                instance.depthVideo.pause();
                updatePlayButton(instanceId);
            });

            instance.rgbVideo.addEventListener('seeked', () => {
                instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
            });

            // Keep videos in sync during playback
            instance.rgbVideo.addEventListener('timeupdate', () => {
                if (Math.abs(instance.rgbVideo.currentTime - instance.depthVideo.currentTime) > 0.1) {
                    instance.depthVideo.currentTime = instance.rgbVideo.currentTime;
                }
            });

            // Handle video end
            instance.rgbVideo.addEventListener('ended', () => {
                instance.depthVideo.pause();
                updatePlayButton(instanceId);
            });

            setupDragHandlers(instanceId);
            updatePlayButton(instanceId);
        }

        function setupDragHandlers(instanceId) {
            const instance = videoComparisons[instanceId];
            
            // Mouse events for divider
            instance.divider.addEventListener('mousedown', (e) => startDrag(e, instanceId));
            
            // Mouse events for container (auto-follow)
            instance.container.addEventListener('mousemove', (e) => handleMouseMoveForInstance(e, instanceId));
            
            // Touch events for mobile
            instance.divider.addEventListener('touchstart', (e) => startDrag(e, instanceId));
        }

        function startDrag(e, instanceId) {
            const instance = videoComparisons[instanceId];
            instance.isDragging = true;
            instance.autoFollow = false;
            e.preventDefault();
            instance.container.style.cursor = 'col-resize';
            
            // Add global event listeners for this specific instance
            const handleMouseMove = (e) => handleMouseMoveForInstance(e, instanceId);
            const handleTouchMove = (e) => handleTouchMoveForInstance(e, instanceId);
            const endDrag = () => endDragForInstance(instanceId, handleMouseMove, handleTouchMove, endDrag);
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', handleTouchMove);
            document.addEventListener('touchend', endDrag);
        }

        function handleMouseMoveForInstance(e, instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance.isDragging && !instance.autoFollow) return;
            
            const rect = instance.container.getBoundingClientRect();
            const isOverContainer = e.clientX >= rect.left && e.clientX <= rect.right && 
                                  e.clientY >= rect.top && e.clientY <= rect.bottom;
            
            if (isOverContainer || instance.isDragging) {
                const x = e.clientX - rect.left;
                const percentage = (x / rect.width) * 100;
                const clampedPercentage = Math.max(0, Math.min(100, percentage));
                updateDividerPosition(instanceId, clampedPercentage);
            }
        }

        function handleTouchMoveForInstance(e, instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance.isDragging) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = instance.container.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const percentage = (x / rect.width) * 100;
            const clampedPercentage = Math.max(0, Math.min(100, percentage));
            updateDividerPosition(instanceId, clampedPercentage);
        }

        function endDragForInstance(instanceId, handleMouseMove, handleTouchMove, endDrag) {
            const instance = videoComparisons[instanceId];
            if (instance.isDragging) {
                instance.isDragging = false;
                instance.container.style.cursor = 'col-resize';
                
                // Remove event listeners
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', endDrag);
                document.removeEventListener('touchmove', handleTouchMove);
                document.removeEventListener('touchend', endDrag);
                
                setTimeout(() => {
                    instance.autoFollow = true;
                }, 2000); // Re-enable auto-follow after 2 seconds
            }
        }

        function updateDividerPosition(instanceId, percentage) {
            const instance = videoComparisons[instanceId];
            if (!instance.divider || !instance.rgbVideo || !instance.depthVideo) return;
            
            // Move the divider
            instance.divider.style.left = percentage + '%';
            
            // Update clip paths for split effect
            const leftClip = `inset(0 ${100 - percentage}% 0 0)`;
            const rightClip = `inset(0 0 0 ${percentage}%)`;
            
            instance.rgbVideo.style.clipPath = leftClip;
            instance.depthVideo.style.clipPath = rightClip;
        }

        function togglePlayback(instanceId) {
            const instance = videoComparisons[instanceId];
            if (!instance || !instance.rgbVideo || !instance.depthVideo) {
                return;
            }
            
            if (instance.rgbVideo.paused) {
                instance.rgbVideo.play().catch(e => console.error(`Play failed for instance ${instanceId}:`, e));
            } else {
                instance.rgbVideo.pause();
            }
        }

        function updatePlayButton(instanceId) {
            const button = document.getElementById(`playButton${instanceId}`);
            const instance = videoComparisons[instanceId];
            
            if (!button || !instance || !instance.rgbVideo) {
                if (button) button.textContent = 'Play';
                return;
            }
            
            button.textContent = instance.rgbVideo.paused ? 'Play' : 'Pause';
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            // Initialize references for existing instances
            for (let i = 1; i <= 2; i++) {
                if (document.getElementById(`rgbVideo${i}`)) {
                    if (!videoComparisons[i]) {
                        videoComparisons[i] = {
                            videosLoaded: 0,
                            isDragging: false,
                            autoFollow: true,
                            container: null,
                            divider: null,
                            rgbVideo: null,
                            depthVideo: null
                        };
                    }
                    updatePlayButton(i);
                }
            }
        });
    </script>
</body>

</html>